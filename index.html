<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আমার পরীক্ষার রুটিন</title>
    <!-- Google Fonts for a clean, professional Bengali font -->
    <link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS variables for a modern, purple and blue theme */
        :root {
            --primary-color: #6a0572;
            --secondary-color: #a540b6;
            --background-gradient: linear-gradient(135deg, #f0eafb 0%, #d8e5f2 100%);
            --card-background: #ffffff;
            --text-color: #333333;
            --light-text-color: #888888;
            --border-radius: 16px;
            --box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.4s ease;
        }

        body {
            font-family: 'Tiro Bangla', sans-serif;
            background: var(--background-gradient);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--card-background);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
        }

        .header-section h1 {
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }

        .header-section .today-btn {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 1em;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            text-decoration: none;
            font-family: inherit;
        }
        
        .header-section .today-btn:hover {
            background-color: var(--secondary-color);
        }

        .subtitle {
            font-size: 1.2em;
            color: var(--light-text-color);
            margin-bottom: 25px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 15px;
        }

        .schedule-table th, .schedule-table td {
            padding: 18px;
            border: none;
            background-color: #f7f3ff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all var(--transition-speed);
            border-radius: var(--border-radius);
            text-align: left;
        }

        .schedule-table thead th {
            background-color: var(--primary-color);
            color: #fff;
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            text-align: center;
        }

        .schedule-table thead th:first-child { border-top-left-radius: var(--border-radius); border-bottom-left-radius: var(--border-radius); }
        .schedule-table thead th:last-child { border-top-right-radius: var(--border-radius); border-bottom-right-radius: var(--border-radius); }

        .schedule-table tbody tr {
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .schedule-table tbody tr:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .schedule-table td:nth-child(1) { font-weight: bold; color: var(--primary-color); }
        .schedule-table td:nth-child(2) { color: var(--secondary-color); font-style: italic; }
        .schedule-table td:nth-child(3) ul { list-style: none; padding: 0; margin: 0; }
        .schedule-table td:nth-child(3) ul li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            position: relative;
            flex-shrink: 0;
        }
        
        .custom-checkbox:hover { border-color: var(--secondary-color); }
        .custom-checkbox.completed { background-color: var(--primary-color); border-color: var(--primary-color); }
        .custom-checkbox.completed::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 14px;
        }

        .exam-row td {
            background-color: #fff0f0 !important;
            border: 2px solid #ff4d4f;
            box-shadow: 0 4px 12px rgba(255, 77, 79, 0.2);
        }

        .week-summary {
            padding: 20px;
            margin-top: 10px;
            background-color: #f0f4f8;
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .week-summary h3 {
            font-size: 1.5em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .summary-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .summary-list li {
            background-color: #e5eaf5;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: var(--text-color);
        }

        /* Full page modal for today's routine */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            animation: fadeIn 0.5s ease-out;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal-content {
            background-color: var(--card-background);
            margin: 0; /* Changed from 5% auto */
            padding: 30px;
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.5s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary-color);
            font-size: 2em;
        }

        .date-navigation {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .date-navigation button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color var(--transition-speed);
        }

        .date-navigation button:hover:not(:disabled) {
            background-color: var(--secondary-color);
        }

        .date-navigation button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2.5em;
            cursor: pointer;
            color: var(--text-color);
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .daily-schedule-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 15px; /* for scrollbar */
        }

        .daily-schedule-item {
            background-color: #f7f3ff;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .daily-schedule-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .daily-schedule-item h3 {
            font-size: 1.5em;
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .daily-schedule-item textarea {
            width: 100%;
            height: 100px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            font-family: 'Tiro Bangla', sans-serif;
            font-size: 1em;
            resize: vertical;
            margin-top: 10px;
            background-color: #fff;
            transition: border-color 0.3s ease;
        }

        .daily-schedule-item textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 5, 114, 0.2);
        }

        .no-routine-message {
            text-align: center;
            padding: 40px;
            font-size: 1.5em;
            color: var(--light-text-color);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        /* Responsive design for small screens */
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .schedule-table, .schedule-table thead, .schedule-table tbody, .schedule-table th, .schedule-table td, .schedule-table tr {
                display: block;
                width: 100%;
            }
            .schedule-table thead { display: none; }
            .schedule-table tr { margin-bottom: 20px; }
            .schedule-table td {
                text-align: right;
                position: relative;
                padding-left: 50%;
                border-radius: 0;
                box-shadow: none;
                background-color: #f0f4f8;
            }
            .schedule-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: var(--primary-color);
            }
            .week-summary { text-align: left; }
            .summary-list { justify-content: flex-start; }
            .summary-list li { width: 100%; }
        }
    </style>
</head>
<body>

<!-- Main Page Content -->
<div class="container">
    <div class="header-section">
        <h1 class="main-title">আমার পরীক্ষার রুটিন</h1>
        <button class="today-btn" id="show-today-btn">আজকের রুটিন</button>
    </div>
    <p class="subtitle">আপনার পরীক্ষার প্রস্তুতির সুন্দর ও সুসংগঠিত তালিকা</p>
    
    <table class="schedule-table">
        <thead>
            <tr>
                <th>তারিখ</th>
                <th>দিন</th>
                <th>বিষয়সমূহ</th>
            </tr>
        </thead>
        <tbody id="schedule-body">
            <!-- Table rows and weekly summaries will be dynamically inserted here -->
        </tbody>
    </table>
</div>

<!-- The Modal for Today's Routine -->
<div id="todayModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="date-navigation">
                <button id="prev-date-btn">&lt;</button>
                <h2 id="modal-date"></h2>
                <button id="next-date-btn">&gt;</button>
            </div>
            <button class="close-btn" id="close-modal-btn">হোম</button>
        </div>
        <div id="daily-schedule-content" class="daily-schedule-content">
            <!-- Daily schedule with notes and checkboxes will be loaded here -->
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Corrected schedule data with English date format for easier parsing
    const scheduleData = [
        { date: "August 24, 2025", day: "রবিবার", subjects: ["ইংরেজি (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "পদার্থবিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 1 },
        { date: "August 25, 2025", day: "সোমবার", subjects: ["বাংলা (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "জীববিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 1 },
        { date: "August 26, 2025", day: "মঙ্গলবার", subjects: ["বাংলা (২য় পত্র)", "ইংরেজি (২য় পত্র)", "পদার্থবিজ্ঞান (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 1 },
        { date: "August 27, 2025", day: "বুধবার", subjects: ["ইংরেজি (২য় পত্র)", "বাংলা (২য় পত্র)", "পদার্থবিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)"], week: 1 },
        { date: "August 28, 2025", day: "বৃহস্পতিবার", subjects: ["ইংরেজি (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "রসায়ন (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 1 },
        { date: "August 29, 2025", day: "শুক্রবার", subjects: ["সার্বিক রিভিশন"], week: 1 },
        { date: "August 30, 2025", day: "শনিবার", subjects: ["তথ্য ও যোগাযোগ প্রযুক্তি", "বাংলা (২য় পত্র)", "পদার্থবিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 1 },
        
        { date: "August 31, 2025", day: "রবিবার", subjects: ["ইংরেজি (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },
        { date: "September 1, 2025", day: "সোমবার", subjects: ["ইংরেজি (২য় পত্র)", "বাংলা (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },
        { date: "September 2, 2025", day: "মঙ্গলবার", subjects: ["ইংরেজি (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "বাংলা (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },
        { date: "September 3, 2025", day: "বুধবার", subjects: ["ইংরেজি (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "বাংলা (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },
        { date: "September 4, 2025", day: "বৃহস্পতিবার", subjects: ["ইংরেজি (২য় পত্র)", "তথ্য ও যোগাযোগ প্রযুক্তি", "বাংলা (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },
        { date: "September 5, 2025", day: "শুক্রবার", subjects: ["প্রথম তিন পরীক্ষার রিভিশন"], week: 2 },
        { date: "September 6, 2025", day: "শনিবার", subjects: ["তথ্য ও যোগাযোগ প্রযুক্তি", "বাংলা (২য় পত্র)", "জীববিজ্ঞান (২য় পত্র)", "রসায়ন (২য় পত্র)", "উচ্চতর গণিত (২য় পত্র)"], week: 2 },

        { date: "September 7, 2025", day: "রবিবার", subjects: ["ইংরেজি (২য় পত্র) পরীক্ষা"], isExamDay: true, nextDaySubjects: ["তথ্য ও যোগাযোগ প্রযুক্তি"], week: 3 },
        { date: "September 8, 2025", day: "সোমবার", subjects: ["তথ্য ও যোগাযোগ প্রযুক্তি পরীক্ষা"], isExamDay: true, nextDaySubjects: ["বাংলা (২য় পত্র)"], week: 3 },
        { date: "September 9, 2025", day: "মঙ্গলবার", subjects: ["বাংলা (২য় পত্র) পরীক্ষা"], isExamDay: true, nextDaySubjects: ["পদার্থবিজ্ঞান (২য় পত্র)"], week: 3 },
        { date: "September 10, 2025", day: "বুধবার", subjects: ["পদার্থবিজ্ঞান (২য় পত্র)"], week: 3 },
        { date: "September 11, 2025", day: "বৃহস্পতিবার", subjects: ["পদার্থবিজ্ঞান (২য় পত্র) পরীক্ষা"], isExamDay: true, nextDaySubjects: ["রসায়ন (২য় পত্র)"], week: 3 },
        { date: "September 12, 2025", day: "শুক্রবার", subjects: ["রসায়ন (২য় পত্র)"], week: 3 },
        { date: "September 13, 2025", day: "শনিবার", subjects: ["রসায়ন (২য় পত্র)"], week: 3 },

        { date: "September 14, 2025", day: "রবিবার", subjects: ["রসায়ন (২য় পত্র)"], week: 4 },
        { date: "September 15, 2025", day: "সোমবার", subjects: ["রসায়ন (২য় পত্র) পরীক্ষা"], isExamDay: true, nextDaySubjects: ["জীববিজ্ঞান (২য় পত্র)"], week: 4 },
        { date: "September 16, 2025", day: "মঙ্গলবার", subjects: ["জীববিজ্ঞান (২য় পত্র)"], week: 4 },
        { date: "September 17, 2025", day: "বুধবার", subjects: ["জীববিজ্ঞান (২য় পত্র) পরীক্ষা"], isExamDay: true, nextDaySubjects: ["উচ্চতর গণিত (২য় পত্র)"], week: 4 },
        { date: "September 18, 2025", day: "বৃহস্পতিবার", subjects: ["উচ্চতর গণিত (২য় পত্র) পরীক্ষা"], isExamDay: true, week: 4 }
    ];

    const tableBody = document.getElementById('schedule-body');
    const weeklyCounts = {};
    let lastWeek = 0;
    
    // Store completion status and notes in localStorage
    const completionData = JSON.parse(localStorage.getItem('studyCompletionData')) || {};
    
    // Helper function to save data to localStorage
    const saveData = () => {
        localStorage.setItem('studyCompletionData', JSON.stringify(completionData));
    };

    // Helper function to get a unique key for a day and subject
    const getKey = (date, subject) => `${date}-${subject}`;
    
    // Formats a Date object to a human-readable Bengali string
    const formatDateBengali = (date) => {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        // Use an array to manually map month names to avoid relying on Intl.DateTimeFormat
        const bengaliMonths = ['জানুয়ারী', 'ফেব্রুয়ারী', 'মার্চ', 'এপ্রিল', 'মে', 'জুন', 'জুলাই', 'আগস্ট', 'সেপ্টেম্বর', 'অক্টোবর', 'নভেম্বর', 'ডিসেম্বর'];
        const day = date.getDate();
        const month = bengaliMonths[date.getMonth()];
        const year = date.getFullYear();

        const suffix = (day) => {
            if (day === 1) return 'লা';
            if (day === 2) return 'রা';
            if (day === 3) return 'রা';
            if (day === 4) return 'ঠা';
            if (day === 5) return 'ই';
            if (day === 6) return 'ই';
            if (day === 7) return 'ই';
            if (day === 8) return 'ই';
            if (day === 9) return 'ই';
            if (day === 10) return 'ই';
            if (day === 11) return 'ই';
            if (day === 12) return 'ই';
            if (day === 13) return 'ই';
            if (day === 14) return 'ই';
            if (day === 15) return 'ই';
            if (day === 16) return 'ই';
            if (day === 17) return 'ই';
            if (day === 18) return 'ই';
            if (day === 19) return 'ই';
            if (day === 20) return 'ই';
            if (day === 21) return 'শে';
            if (day === 22) return 'শে';
            if (day === 23) return 'শে';
            if (day === 24) return 'শে';
            if (day === 25) return 'শে';
            if (day === 26) return 'শে';
            if (day === 27) return 'শে';
            if (day === 28) return 'শে';
            if (day === 29) return 'শে';
            if (day === 30) return 'শে';
            if (day === 31) return 'শে';
            return '';
        };

        return `${day}${suffix(day)} ${month}, ${year}`;
    };

    // Helper function to create and append the weekly summary row
    function appendWeeklySummary(weekNumber, counts) {
        if (Object.keys(counts).length === 0) return;
        
        const summaryRow = document.createElement('tr');
        summaryRow.className = 'week-summary-row';
        const summaryCell = document.createElement('td');
        summaryCell.colSpan = 3;
        summaryCell.className = 'week-summary-cell';
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'week-summary';
        const summaryTitle = document.createElement('h3');
        summaryTitle.textContent = `সপ্তাহ ${weekNumber} এর সংক্ষিপ্ত হিসাব`;
        summaryDiv.appendChild(summaryTitle);

        const summaryList = document.createElement('ul');
        summaryList.className = 'summary-list';
        for (const subject in counts) {
            const listItem = document.createElement('li');
            listItem.textContent = `${subject}: ${counts[subject]} দিন`;
            summaryList.appendChild(listItem);
        }
        summaryDiv.appendChild(summaryList);
        summaryCell.appendChild(summaryDiv);
        summaryRow.appendChild(summaryCell);
        tableBody.appendChild(summaryRow);
    }
    
    // Process each day's data
    scheduleData.forEach((day, index) => {
        // If a new week starts, append the previous week's summary
        if (day.week !== lastWeek && lastWeek !== 0) {
            appendWeeklySummary(lastWeek, weeklyCounts[lastWeek]);
        }
        
        // Initialize weekly count for the current week if not present
        if (!weeklyCounts[day.week]) {
            weeklyCounts[day.week] = {};
        }

        const row = document.createElement('tr');
        if (day.isExamDay) {
            row.classList.add('exam-row');
        }

        const dateCell = document.createElement('td');
        dateCell.setAttribute('data-label', 'তারিখ');
        dateCell.textContent = formatDateBengali(new Date(day.date));
        row.appendChild(dateCell);

        const dayCell = document.createElement('td');
        dayCell.setAttribute('data-label', 'দিন');
        dayCell.textContent = day.day;
        row.appendChild(dayCell);

        const subjectsCell = document.createElement('td');
        subjectsCell.setAttribute('data-label', 'বিষয়সমূহ');
        const subjectList = document.createElement('ul');
        
        // Handle subjects for the day
        const allSubjects = day.subjects.slice();
        if (day.nextDaySubjects && day.nextDaySubjects.length > 0) {
            allSubjects.push(`(পরীক্ষার পর: ${day.nextDaySubjects.join(", ")})`);
        }

        allSubjects.forEach(subject => {
            const listItem = document.createElement('li');
            
            // Checkbox and subject name
            const checkbox = document.createElement('div');
            checkbox.className = 'custom-checkbox';
            const key = getKey(day.date, subject);
            
            if (completionData[key] && completionData[key].completed) {
                checkbox.classList.add('completed');
            }
            
            checkbox.onclick = () => {
                const isCompleted = checkbox.classList.toggle('completed');
                if (!completionData[key]) { completionData[key] = {}; }
                completionData[key].completed = isCompleted;
                saveData();
            };
            
            listItem.appendChild(checkbox);
            
            const subjectSpan = document.createElement('span');
            subjectSpan.textContent = subject;
            listItem.appendChild(subjectSpan);
            subjectList.appendChild(listItem);
            
            // Count subjects for the weekly summary, excluding non-subjects
            const baseSubject = subject.replace(/ পরীক্ষা$/, '').replace(/ \(পরীক্ষার পর:.*$/, '');
            if (baseSubject.trim() !== "" && baseSubject !== "সার্বিক রিভিশন" && baseSubject !== "প্রথম তিন পরীক্ষার রিভিশন") {
                 weeklyCounts[day.week][baseSubject] = (weeklyCounts[day.week][baseSubject] || 0) + 1;
            }
        });

        subjectsCell.appendChild(subjectList);
        row.appendChild(subjectsCell);
        tableBody.appendChild(row);

        lastWeek = day.week;

        // Append summary for the very last week
        if (index === scheduleData.length - 1) {
            appendWeeklySummary(lastWeek, weeklyCounts[lastWeek]);
        }
    });
    
    // Full-page modal for today's routine logic
    const todayModal = document.getElementById('todayModal');
    const showTodayBtn = document.getElementById('show-today-btn');
    const closeTodayBtn = document.getElementById('close-modal-btn');
    const modalDateDisplay = document.getElementById('modal-date');
    const prevDateBtn = document.getElementById('prev-date-btn');
    const nextDateBtn = document.getElementById('next-date-btn');
    const dailyContent = document.getElementById('daily-schedule-content');
    
    let currentDateIndex = 0;
    
    const renderDailySchedule = (dateIndex) => {
        dailyContent.innerHTML = '';
        const todayData = scheduleData[dateIndex];
        
        // Format the date for display in the modal header
        const formattedDate = formatDateBengali(new Date(todayData.date));
        modalDateDisplay.textContent = formattedDate;

        if (todayData) {
            todayData.subjects.forEach(subject => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'daily-schedule-item';
                
                const subjectHeading = document.createElement('h3');
                const checkbox = document.createElement('div');
                checkbox.className = 'custom-checkbox';
                const key = getKey(todayData.date, subject);
                
                if (completionData[key] && completionData[key].completed) {
                    checkbox.classList.add('completed');
                }
                
                checkbox.onclick = () => {
                    const isCompleted = checkbox.classList.toggle('completed');
                    if (!completionData[key]) { completionData[key] = {}; }
                    completionData[key].completed = isCompleted;
                    saveData();
                };

                subjectHeading.appendChild(checkbox);
                const subjectSpan = document.createElement('span');
                subjectSpan.textContent = subject;
                subjectHeading.appendChild(subjectSpan);
                itemDiv.appendChild(subjectHeading);
                
                const notesLabel = document.createElement('p');
                notesLabel.textContent = "নোট যুক্ত করুন:";
                notesLabel.style.margin = "0 0 5px 0";
                itemDiv.appendChild(notesLabel);

                const notesTextarea = document.createElement('textarea');
                notesTextarea.placeholder = "আপনার নোট এখানে লিখুন...";
                if (completionData[key] && completionData[key].notes) {
                    notesTextarea.value = completionData[key].notes;
                }
                
                notesTextarea.oninput = () => {
                    if (!completionData[key]) { completionData[key] = {}; }
                    completionData[key].notes = notesTextarea.value;
                    saveData();
                };
                
                itemDiv.appendChild(notesTextarea);
                dailyContent.appendChild(itemDiv);
            });
        } else {
            const noRoutineMsg = document.createElement('div');
            noRoutineMsg.className = 'no-routine-message';
            noRoutineMsg.textContent = "এই দিনের জন্য কোনো রুটিন নেই।";
            dailyContent.appendChild(noRoutineMsg);
        }
    };
    
    // Find today's date in the schedule
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Normalize today's date
    currentDateIndex = scheduleData.findIndex(d => {
        const dateObj = new Date(d.date);
        dateObj.setHours(0, 0, 0, 0);
        return dateObj.getTime() === today.getTime();
    });
    
    if (currentDateIndex === -1) {
        currentDateIndex = 0; // Default to the first day if today's date is not in the schedule
    }

    showTodayBtn.onclick = () => {
        todayModal.style.display = "flex";
        renderDailySchedule(currentDateIndex);
        updateNavigationButtons();
    };
    
    closeTodayBtn.onclick = () => {
        todayModal.style.display = "none";
    };

    window.onclick = (event) => {
        if (event.target == todayModal) {
            todayModal.style.display = "none";
        }
    };

    // Update navigation buttons state
    const updateNavigationButtons = () => {
        prevDateBtn.disabled = currentDateIndex <= 0;
        nextDateBtn.disabled = currentDateIndex >= scheduleData.length - 1;
    };

    prevDateBtn.onclick = () => {
        if (currentDateIndex > 0) {
            currentDateIndex--;
            renderDailySchedule(currentDateIndex);
            updateNavigationButtons();
        }
    };

    nextDateBtn.onclick = () => {
        if (currentDateIndex < scheduleData.length - 1) {
            currentDateIndex++;
            renderDailySchedule(currentDateIndex);
            updateNavigationButtons();
        }
    };
});
</script>

</body>
</html>
